{
  "hash": "5844d9cd054572dabcb1483a3f3b683d",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Calendar-Year Correlation in Meyers' Loss Triangles\"\ndate: 2025-12-05\ncategories: [analysis, insurance]\nsubtitle: \"Estimating diagonal dependence with an AR(1) calendar effect\"\ndraft: false\nformat:\n  html:\n    fig-format: svg\n---\n\nUnderstanding how observations within a loss development triangle move together is essential when reserving\nwith correlated errors. This post uses the **CAS loss reserve database** as assembled in the\n[`reservetestr-python`](https://github.com/problemofpoints/reservetestr-python) project to measure\nthe calendar-year dependence implied by the Meyers 200 test triangles. The correlation structure proposed in\nFigure 2.3.1 above treats each diagonal (calendar year) as following an AR(1) process, so that the correlation\nbetween cells `k` years apart on the same diagonal is approximately $\\rho^{k}$. We estimate that parameter for\neach line of business, for the full collection of triangles, and then use it to build the full correlation matrix\nacross diagonals.\n\nWe work with cumulative **paid** losses for the four major NAIC lines—Commercial Auto, Personal Auto, Workers' Comp,\nand Other Liability—and we summarize how strongly adjacent diagonals move together. Each triangle appears twice in\nthe raw file (train/test splits), so we focus on the **training** segment to keep one copy of every cell.\n\n## Data preparation\n\n::: {#3fd214b5 .cell execution_count=1}\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>line</th>\n      <th>triangle_count</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>comauto</td>\n      <td>50</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>othliab</td>\n      <td>50</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>ppauto</td>\n      <td>50</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>wkcomp</td>\n      <td>50</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## From development factors to calendar effects\n\nWe convert each cumulative triangle to development factors, remove the average pattern for each development\nlag, and average the residuals by calendar year. This isolates the calendar effect that the AR(1) process is\nsupposed to capture, while keeping a common development structure across all triangles.\n\n::: {#638076b6 .cell execution_count=2}\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\ncount    9.000000\nmean     0.004511\nstd      0.014029\nmin     -0.010031\n25%     -0.001768\n50%     -0.000173\n75%      0.005643\nmax      0.039350\nName: resid, dtype: float64\n```\n:::\n:::\n\n\n## AR(1) estimate for diagonal correlation\n\nThe AR(1) parameter $\\rho$ can be estimated by regressing the calendar effect on its own one-period lag. That slope\nis unconstrained and can drift outside $[-1, 1]$, so it should be viewed as an autoregressive coefficient, not a\ndirect correlation. We also show the empirical autocorrelation function (ACF) for the first five lags and compare\nit with the AR(1) pattern $\\rho^k$. Confidence intervals use the Fisher $z$ approximation with effective sample size\nequal to the number of calendar years contributing to each lag.\n\n::: {#f216c4c3 .cell execution_count=3}\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\n(0.066078431031656,\n (np.float64(-0.6731128447249469), np.float64(0.8052697067882589)),\n   Line of business  Calendar years AR(1) r        95% CI\n 0  Commercial Auto               9    0.63  [0.05, 1.20]\n 1  Other Liability               9    0.67  [0.12, 1.22]\n 2    Personal Auto               9    0.89  [0.55, 1.23]\n 3    Workers' Comp               9    0.88  [0.54, 1.23])\n```\n:::\n:::\n\n\nThe table summarizes the line-level AR(1) fits, including the number of usable calendar years in each series.\nCommercial Auto and Workers' Comp exhibit stronger positive correlation in adjacent diagonals, while Personal\nAuto sits nearer to zero and Other Liability dips negative. Those offsets explain why the pooled grand-mean AR(1)\nestimate remains small even though individual lines show clear trends.\n\n::: {#6fe5790e .cell fig-format='svg' fig-height='4' fig-width='7' execution_count=4}\n\n::: {.cell-output .cell-output-display execution_count=4}\n![](index_files/figure-html/cell-5-output-1.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-5-output-2.svg){}\n:::\n:::\n\n\n::: {#7e0ad9a0 .cell fig-format='svg' fig-height='4' fig-width='7' execution_count=5}\n\n::: {.cell-output .cell-output-display execution_count=5}\n![](index_files/figure-html/cell-6-output-1.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-6-output-2.svg){}\n:::\n:::\n\n\n## Correlation matrix from the AR(1) estimate\n\nThe AR(1) parameter implies a Toeplitz correlation matrix along calendar-year diagonals. The table below uses the\npooled estimate across all four lines to populate a 10-year-by-10-year diagonal correlation matrix, where entry\n$i, j$ equals $\\rho^{|i-j|}$.\n\n::: {#0bbb0efb .cell execution_count=6}\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>CY1</th>\n      <th>CY2</th>\n      <th>CY3</th>\n      <th>CY4</th>\n      <th>CY5</th>\n      <th>CY6</th>\n      <th>CY7</th>\n      <th>CY8</th>\n      <th>CY9</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>CY1</th>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n      <td>4.366359e-03</td>\n      <td>0.000289</td>\n      <td>0.000019</td>\n      <td>0.000001</td>\n      <td>8.324503e-08</td>\n      <td>5.500701e-09</td>\n      <td>3.634777e-10</td>\n    </tr>\n    <tr>\n      <th>CY2</th>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n      <td>0.004366</td>\n      <td>0.000289</td>\n      <td>0.000019</td>\n      <td>1.259791e-06</td>\n      <td>8.324503e-08</td>\n      <td>5.500701e-09</td>\n    </tr>\n    <tr>\n      <th>CY3</th>\n      <td>4.366359e-03</td>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n      <td>0.066078</td>\n      <td>0.004366</td>\n      <td>0.000289</td>\n      <td>1.906509e-05</td>\n      <td>1.259791e-06</td>\n      <td>8.324503e-08</td>\n    </tr>\n    <tr>\n      <th>CY4</th>\n      <td>2.885222e-04</td>\n      <td>4.366359e-03</td>\n      <td>6.607843e-02</td>\n      <td>1.000000</td>\n      <td>0.066078</td>\n      <td>0.004366</td>\n      <td>2.885222e-04</td>\n      <td>1.906509e-05</td>\n      <td>1.259791e-06</td>\n    </tr>\n    <tr>\n      <th>CY5</th>\n      <td>1.906509e-05</td>\n      <td>2.885222e-04</td>\n      <td>4.366359e-03</td>\n      <td>0.066078</td>\n      <td>1.000000</td>\n      <td>0.066078</td>\n      <td>4.366359e-03</td>\n      <td>2.885222e-04</td>\n      <td>1.906509e-05</td>\n    </tr>\n    <tr>\n      <th>CY6</th>\n      <td>1.259791e-06</td>\n      <td>1.906509e-05</td>\n      <td>2.885222e-04</td>\n      <td>0.004366</td>\n      <td>0.066078</td>\n      <td>1.000000</td>\n      <td>6.607843e-02</td>\n      <td>4.366359e-03</td>\n      <td>2.885222e-04</td>\n    </tr>\n    <tr>\n      <th>CY7</th>\n      <td>8.324503e-08</td>\n      <td>1.259791e-06</td>\n      <td>1.906509e-05</td>\n      <td>0.000289</td>\n      <td>0.004366</td>\n      <td>0.066078</td>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n      <td>4.366359e-03</td>\n    </tr>\n    <tr>\n      <th>CY8</th>\n      <td>5.500701e-09</td>\n      <td>8.324503e-08</td>\n      <td>1.259791e-06</td>\n      <td>0.000019</td>\n      <td>0.000289</td>\n      <td>0.004366</td>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n    </tr>\n    <tr>\n      <th>CY9</th>\n      <td>3.634777e-10</td>\n      <td>5.500701e-09</td>\n      <td>8.324503e-08</td>\n      <td>0.000001</td>\n      <td>0.000019</td>\n      <td>0.000289</td>\n      <td>4.366359e-03</td>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Rank correlations by line and lag\n\nTo feed a positive-definite calendar-year correlation matrix, we also compute Spearman rank correlations between\neach line's calendar-effect series and its own lagged copies. These coefficients are bounded inside $[-1, 1]$ by\nconstruction and can be used directly when parameterizing a correlation matrix.\n\n::: {#58f3c539 .cell execution_count=7}\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>lag</th>\n      <th>Lag 1</th>\n      <th>Lag 2</th>\n      <th>Lag 3</th>\n      <th>Lag 4</th>\n      <th>Lag 5</th>\n    </tr>\n    <tr>\n      <th>Line of business</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Commercial Auto</th>\n      <td>0.31</td>\n      <td>0.29</td>\n      <td>0.14</td>\n      <td>-0.70</td>\n      <td>0.80</td>\n    </tr>\n    <tr>\n      <th>Other Liability</th>\n      <td>0.81</td>\n      <td>0.57</td>\n      <td>0.71</td>\n      <td>0.60</td>\n      <td>0.80</td>\n    </tr>\n    <tr>\n      <th>Personal Auto</th>\n      <td>0.98</td>\n      <td>0.96</td>\n      <td>0.94</td>\n      <td>0.90</td>\n      <td>0.80</td>\n    </tr>\n    <tr>\n      <th>Workers' Comp</th>\n      <td>-0.24</td>\n      <td>0.21</td>\n      <td>-0.54</td>\n      <td>-0.10</td>\n      <td>-0.20</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Takeaways\n\n::: {#4a54f144 .cell execution_count=8}\n\n::: {.cell-output .cell-output-display .cell-output-markdown}\n\n- Across the 200 Meyers triangles, the grand-mean AR(1) correlation between adjacent calendar-year diagonals is\n  **`r = 0.07`** with a 95% confidence interval of **`[-0.67, 0.81]`**. Because lines\n  pull in opposite directions in some calendar years, this pooled estimate is much lower than the within-line\n  correlations even though each line shows a strong trend on its own.\n- Line-by-line AR(1) estimates show meaningful variation: `r = 0.63` for\n  Commercial Auto, `r = 0.67` for\n  Other Liability, `r = 0.89` for\n  Personal Auto, and `r = 0.88` for\n  Workers' Comp (see table above for exact confidence intervals). Pooling all\n  lines yields the Toeplitz correlation matrix reported above, matching the structure in the reference figure.\n- Spearman rank correlations by line and lag stay inside $[-1, 1]$ and can feed a positive-definite calendar-year\n  correlation matrix without additional truncation. The table above lists lags 1–5 for each line.\n- The empirical autocorrelations fall close to the AR(1) curve $\rho^k$, suggesting that the diagonal dependence\n  can be summarized by a single parameter without large residual structure. This AR(1) fit is a reasonable\n  diagnostic for calendar effects before applying an ODP bootstrap, but the best way to model residual\n  correlation in the `chainladder` ODP bootstrap is to use a fitted GLM (or state-space/variance model) that\n  explicitly includes calendar-year parameters rather than imposing correlation on resampled residuals.\n\n:::\n:::\n\n\nThe AR(1) calendar-year effect provides a practical way to capture the dominant diagonal correlation while keeping\nchain-ladder style development structure intact. When projecting reserves, this $\\rho$ feeds directly into the\ncell-level covariance matrix implied by Figure 2.3.1 and enables interval estimates that respect the calendar\npattern visible in historical data.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}