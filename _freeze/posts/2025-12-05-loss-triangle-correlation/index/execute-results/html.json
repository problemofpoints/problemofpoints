{
  "hash": "92b35130b858d2bddc5695e1d9e67f3d",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Calendar-Year Correlation in Meyers' Loss Triangles\"\ndate: 2025-12-05\ncategories: [analysis, insurance]\nsubtitle: \"Estimating diagonal dependence with an AR(1) calendar effect\"\ndraft: false\nformat:\n  html:\n    fig-format: svg\n---\n\nUnderstanding how observations within a loss development triangle move together is essential when reserving\nwith correlated errors. This post uses the **CAS loss reserve database** as assembled in the\n[`reservetestr-python`](https://github.com/problemofpoints/reservetestr-python) project to measure\nthe calendar-year dependence implied by the Meyers 200 test triangles. The correlation structure proposed in\nFigure 2.3.1 above treats each diagonal (calendar year) as following an AR(1) process, so that the correlation\nbetween cells `k` years apart on the same diagonal is approximately $\\rho^{k}$. We estimate that parameter for\neach line of business, for the full collection of triangles, and then use it to build the full correlation matrix\nacross diagonals.\n\nWe work with cumulative **paid** losses for the four major NAIC lines—Commercial Auto, Personal Auto, Workers' Comp,\nand Other Liability—and we summarize how strongly adjacent diagonals move together. Each triangle appears twice in\nthe raw file (train/test splits), so we focus on the **training** segment to keep one copy of every cell.\n\n## Data preparation\n\n::: {#0e4158cf .cell execution_count=1}\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>line</th>\n      <th>triangle_count</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>comauto</td>\n      <td>50</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>othliab</td>\n      <td>50</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>ppauto</td>\n      <td>50</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>wkcomp</td>\n      <td>50</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## From development factors to calendar effects\n\nWe convert each cumulative triangle to development factors, remove the average pattern for each development\nlag, and average the residuals by calendar year. This isolates the calendar effect that the AR(1) process is\nsupposed to capture, while keeping a common development structure across all triangles.\n\n::: {#5e5d0b2e .cell execution_count=2}\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\ncount    9.000000\nmean     0.004511\nstd      0.014029\nmin     -0.010031\n25%     -0.001768\n50%     -0.000173\n75%      0.005643\nmax      0.039350\nName: resid, dtype: float64\n```\n:::\n:::\n\n\n## AR(1) estimate for diagonal correlation\n\nThe AR(1) parameter $\\rho$ can be estimated by regressing the calendar effect on its own one-period lag. We also\nshow the empirical autocorrelation function (ACF) for the first five lags and compare it with the AR(1) pattern\n$\\rho^k$. Confidence intervals use the Fisher $z$ approximation with effective sample size equal to the number of\ncalendar years contributing to each lag.\n\n::: {#fe84b473 .cell execution_count=3}\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\n(0.066078431031656,\n (np.float64(-0.6731128447249469), np.float64(0.8052697067882589)),\n       line       phi    ci_low   ci_high  obs     display_name\n 0  comauto  0.625719  0.047851  1.203587    9  Commercial Auto\n 1  othliab  0.670058  0.120148  1.219968    9  Other Liability\n 2   ppauto  0.887712  0.546645  1.228780    9    Personal Auto\n 3   wkcomp  0.883734  0.537042  1.230426    9    Workers' Comp)\n```\n:::\n:::\n\n\n::: {#441363b8 .cell fig-format='svg' fig-height='4' fig-width='7' execution_count=4}\n\n::: {.cell-output .cell-output-display execution_count=10}\n![](index_files/figure-html/cell-5-output-1.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-5-output-2.svg){}\n:::\n:::\n\n\n## Correlation matrix from the AR(1) estimate\n\nThe AR(1) parameter implies a Toeplitz correlation matrix along calendar-year diagonals. The table below uses the\npooled estimate across all four lines to populate a 10-year-by-10-year diagonal correlation matrix, where entry\n$i, j$ equals $\\rho^{|i-j|}$.\n\n::: {#5de482fe .cell execution_count=5}\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>CY1</th>\n      <th>CY2</th>\n      <th>CY3</th>\n      <th>CY4</th>\n      <th>CY5</th>\n      <th>CY6</th>\n      <th>CY7</th>\n      <th>CY8</th>\n      <th>CY9</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>CY1</th>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n      <td>4.366359e-03</td>\n      <td>0.000289</td>\n      <td>0.000019</td>\n      <td>0.000001</td>\n      <td>8.324503e-08</td>\n      <td>5.500701e-09</td>\n      <td>3.634777e-10</td>\n    </tr>\n    <tr>\n      <th>CY2</th>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n      <td>0.004366</td>\n      <td>0.000289</td>\n      <td>0.000019</td>\n      <td>1.259791e-06</td>\n      <td>8.324503e-08</td>\n      <td>5.500701e-09</td>\n    </tr>\n    <tr>\n      <th>CY3</th>\n      <td>4.366359e-03</td>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n      <td>0.066078</td>\n      <td>0.004366</td>\n      <td>0.000289</td>\n      <td>1.906509e-05</td>\n      <td>1.259791e-06</td>\n      <td>8.324503e-08</td>\n    </tr>\n    <tr>\n      <th>CY4</th>\n      <td>2.885222e-04</td>\n      <td>4.366359e-03</td>\n      <td>6.607843e-02</td>\n      <td>1.000000</td>\n      <td>0.066078</td>\n      <td>0.004366</td>\n      <td>2.885222e-04</td>\n      <td>1.906509e-05</td>\n      <td>1.259791e-06</td>\n    </tr>\n    <tr>\n      <th>CY5</th>\n      <td>1.906509e-05</td>\n      <td>2.885222e-04</td>\n      <td>4.366359e-03</td>\n      <td>0.066078</td>\n      <td>1.000000</td>\n      <td>0.066078</td>\n      <td>4.366359e-03</td>\n      <td>2.885222e-04</td>\n      <td>1.906509e-05</td>\n    </tr>\n    <tr>\n      <th>CY6</th>\n      <td>1.259791e-06</td>\n      <td>1.906509e-05</td>\n      <td>2.885222e-04</td>\n      <td>0.004366</td>\n      <td>0.066078</td>\n      <td>1.000000</td>\n      <td>6.607843e-02</td>\n      <td>4.366359e-03</td>\n      <td>2.885222e-04</td>\n    </tr>\n    <tr>\n      <th>CY7</th>\n      <td>8.324503e-08</td>\n      <td>1.259791e-06</td>\n      <td>1.906509e-05</td>\n      <td>0.000289</td>\n      <td>0.004366</td>\n      <td>0.066078</td>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n      <td>4.366359e-03</td>\n    </tr>\n    <tr>\n      <th>CY8</th>\n      <td>5.500701e-09</td>\n      <td>8.324503e-08</td>\n      <td>1.259791e-06</td>\n      <td>0.000019</td>\n      <td>0.000289</td>\n      <td>0.004366</td>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n      <td>6.607843e-02</td>\n    </tr>\n    <tr>\n      <th>CY9</th>\n      <td>3.634777e-10</td>\n      <td>5.500701e-09</td>\n      <td>8.324503e-08</td>\n      <td>0.000001</td>\n      <td>0.000019</td>\n      <td>0.000289</td>\n      <td>4.366359e-03</td>\n      <td>6.607843e-02</td>\n      <td>1.000000e+00</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Takeaways\n\n::: {#fdbdc5ad .cell execution_count=6}\n\n::: {.cell-output .cell-output-display .cell-output-markdown}\n\n- Across the 200 Meyers triangles, the estimated AR(1) correlation between adjacent calendar-year diagonals is\n  **`r = 0.07`** with a 95% confidence interval of **`[-0.67, 0.81]`**.\n- Line-by-line AR(1) estimates show meaningful variation: `r = 0.63` for\n  Commercial Auto, `r = 0.67` for\n  Other Liability, `r = 0.89` for\n  Personal Auto, and `r = 0.88` for\n  Workers' Comp (see table above for exact confidence intervals). Pooling all\n  lines yields the Toeplitz correlation matrix reported above, matching the structure in the reference figure.\n- The empirical autocorrelations fall close to the AR(1) curve $\rho^k$, suggesting that the diagonal dependence\n  can be summarized by a single parameter without large residual structure. This AR(1) fit is a reasonable\n  diagnostic for calendar effects before applying an ODP bootstrap, but the best way to model residual\n  correlation in the `chainladder` ODP bootstrap is to use a fitted GLM (or state-space/variance model) that\n  explicitly includes calendar-year parameters rather than imposing correlation on resampled residuals.\n\n:::\n:::\n\n\nThe AR(1) calendar-year effect provides a practical way to capture the dominant diagonal correlation while keeping\nchain-ladder style development structure intact. When projecting reserves, this $\\rho$ feeds directly into the\ncell-level covariance matrix implied by Figure 2.3.1 and enables interval estimates that respect the calendar\npattern visible in historical data.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}